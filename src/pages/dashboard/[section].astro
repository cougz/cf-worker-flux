---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import Sidebar from '../../components/layout/Sidebar.astro';
import Panel from '../../components/display/Panel.astro';
import Button from '../../components/interactive/Button.astro';
import Slider from '../../components/interactive/Slider.astro';
import RangeSlider from '../../components/interactive/RangeSlider.astro';
import Input from '../../components/interactive/Input.astro';
import Select from '../../components/interactive/Select.astro';
import Toggle from '../../components/interactive/Toggle.astro';
import ValueDisplay from '../../components/display/ValueDisplay.astro';
import AlertBox from '../../components/display/AlertBox.astro';
import ConfigBlock from '../../components/display/ConfigBlock.astro';

const { section } = Astro.params;

const sectionConfig: Record<string, { title: string; description: string; icon: string }> = {
  'resources': {
    title: 'Resources',
    description: 'Manage and monitor your Cloudflare resources',
    icon: 'üì¶'
  },
  'configuration': {
    title: 'Configuration',
    description: 'Configure worker settings and preferences',
    icon: '‚öôÔ∏è'
  },
  'analytics': {
    title: 'Analytics',
    description: 'View performance metrics and statistics',
    icon: 'üìä'
  },
  'settings': {
    title: 'Settings',
    description: 'Manage dashboard and account settings',
    icon: 'üîß'
  },
  'caching': {
    title: 'Caching',
    description: 'Manage Cloudflare cache rules',
    icon: 'üíæ'
  }
};

const config = section && sectionConfig[section] ? sectionConfig[section] : { title: section || 'Overview', description: '', icon: '‚ö°' };
---

<DashboardLayout title={config.title} description={config.description}>
  <div class="module-wrapper">
    <Sidebar />
    <div class="module-content-wrapper">
      <div id={section} class="module-content">
        <div class="module-header">
          <h1>{config.icon} {config.title}</h1>
          <p>{config.description}</p>
        </div>

        {section === 'resources' && (
          <Panel title="Resource Controls" badge="Active">
            <Toggle id="resource-1" label="Enable Cache" checked />
            <Toggle id="resource-2" label="Enable Rate Limiting" checked />
            <Toggle id="resource-3" label="Enable Analytics" />

            <Slider
              id="cache-ttl"
              label="Cache TTL (minutes)"
              min={1}
              max={1440}
              defaultValue={60}
            />

            <Button
              label="Save Changes"
              actionName="save-resource-state"
              variant="primary"
            />
          </Panel>
        )}

        {section === 'configuration' && (
          <Panel title="Worker Configuration">
            <Input
              id="api-endpoint"
              label="API Endpoint"
              type="text"
              placeholder="https://api.cloudflare.com"
              required
            />

            <Select
              id="region"
              label="Region"
              options={[
                { value: 'us-east', label: 'US East' },
                { value: 'us-west', label: 'US West' },
                { value: 'eu-west', label: 'EU West' },
                { value: 'asia-east', label: 'Asia East' }
              ]}
              defaultValue="us-east"
            />

            <RangeSlider
              id="memory-limits"
              label="Memory Limits (MB)"
              min={128}
              max={1024}
              defaultMin={256}
              defaultMax={512}
              step={64}
            />

            <div class="flex gap-4 mt-4">
              <Button label="Test Connection" actionName="test-api-connection" variant="secondary" />
              <Button label="Save Configuration" actionName="update-config" variant="primary" />
            </div>
          </Panel>
        )}

        {section === 'analytics' && (
          <>
            <Panel title="Performance Metrics" badge="Live">
              <div class="analytics-grid">
                <ValueDisplay
                  label="Total Requests"
                  value="142,853"
                  format="number"
                  status="success"
                />
                <ValueDisplay
                  label="Error Rate"
                  value="0.12%"
                  format="text"
                  status="success"
                />
                <ValueDisplay
                  label="Avg Latency"
                  value="45ms"
                  format="text"
                  status="info"
                />
                <ValueDisplay
                  label="Cache Hit Rate"
                  value="94.2%"
                  format="text"
                  status="success"
                />
              </div>

              <Button
                label="Refresh Analytics"
                actionName="get-analytics"
                variant="secondary"
              />
            </Panel>

            <Panel title="Time Range Filter">
              <Slider
                id="time-range"
                label="Time Range (hours)"
                min={1}
                max={168}
                defaultValue={24}
              />
            </Panel>

            <AlertBox
              type="info"
              title="Analytics Note"
              message="Analytics data is updated every 5 minutes. Last update: 2 minutes ago."
            />
          </>
        )}

        {section === 'settings' && (
          <>
            <Panel title="Dashboard Settings">
              <Toggle id="dark-mode" label="Dark Mode" />
              <Toggle id="notifications" label="Enable Notifications" checked />
              <Toggle id="auto-refresh" label="Auto Refresh" />

              <Input
                id="refresh-interval"
                label="Refresh Interval (seconds)"
                type="number"
                placeholder="30"
                defaultValue="30"
              />

              <Button label="Save Settings" actionName="update-config" variant="primary" />
            </Panel>

            <Panel title="Account Settings" collapsible>
              <Input
                id="account-name"
                label="Account Name"
                type="text"
                placeholder="My Account"
              />

              <Input
                id="api-key"
                label="API Key"
                type="password"
                placeholder="Enter your API key"
                required
              />

              <Button label="Update Account" actionName="update-config" variant="secondary" />
            </Panel>
          </>
        )}

        {section === 'caching' && (
          <Panel title="Cache Management">
            <p style="margin-bottom: 16px; color: var(--text-secondary);">
              Manage your Cloudflare cache rules by enabling or disabling specific rules.
            </p>
            <a href="/dashboard/caching/manage" class="button button-primary button-md">
              <span class="button-text">Manage Cache Rules</span>
            </a>
          </Panel>
        )}
      </div>
    </div>
  </div>
</DashboardLayout>

<style>
  .analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-bottom: 16px;
  }

  @media (max-width: 768px) {
    .analytics-grid {
      grid-template-columns: 1fr 1fr;
    }
  }

  .button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-family: inherit;
    font-weight: 500;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;
    border: none;
  }

  .button-primary {
    background: var(--cf-orange);
    color: white;
    border: 2px solid var(--cf-orange);
  }

  .button-primary:hover {
    background: var(--cf-orange-dark);
    border-color: var(--cf-orange-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .button-md {
    padding: 12px 24px;
    font-size: 1rem;
  }
</style>

