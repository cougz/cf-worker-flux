---
const sections = [
  { 
    id: 'images', 
    label: 'Images', 
    path: '/dashboard/images',
    subsections: [
      { id: 'transform-via-url', label: 'Transform via URL', path: '/dashboard/images' }
    ]
  },
  { id: 'firewall-ai', label: 'Firewall for AI', path: '/dashboard/firewall-ai' },
];
---
---

<aside class="sidebar">
  <div class="sidebar-title">Navigation</div>
  <ul class="sidebar-nav">
    {sections.map((section) => (
      <li class={section.subsections ? 'nav-item-with-subsections' : ''}>
        <a
          href={section.path}
          data-section={section.id}
          data-astro-prefetch
        >
          {section.label}
        </a>
        {section.subsections && (
          <ul class="subsection-nav">
            {section.subsections.map((subsection) => (
              <li>
                <a
                  href={subsection.path}
                  data-section={subsection.id}
                  data-astro-prefetch
                >
                  {subsection.label}
                </a>
              </li>
            ))}
          </ul>
        )}
      </li>
    ))}
  </ul>
</aside>

<style>
  .sidebar {
    width: 250px;
    flex-shrink: 0;
    background: var(--card-bg);
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--shadow-subtle);
    position: sticky;
    top: 20px;
    max-height: calc(100vh - 40px);
    overflow-y: auto;
  }

  .sidebar-title {
    font-size: 1.2em;
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--text-primary);
  }

  .sidebar-nav {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .sidebar-nav li {
    margin-bottom: 5px;
  }

  .sidebar-nav a {
    display: block;
    padding: 10px 14px;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-size: 0.9em;
    font-weight: 500;
  }

  .sidebar-nav a:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
  }

  .sidebar-nav a.active {
    background: var(--cf-orange);
    color: white;
  }

  .nav-item-with-subsections {
    padding-bottom: 8px;
  }

  .subsection-nav {
    list-style: none;
    padding-left: 20px;
    margin-top: 5px;
  }

  .subsection-nav li {
    margin-bottom: 3px;
  }

  .subsection-nav a {
    display: block;
    padding: 6px 10px;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 4px;
    transition: all 0.2s ease;
    font-size: 0.85em;
    font-weight: 500;
  }

  .subsection-nav a:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
  }

  .subsection-nav a.active {
    background: var(--cf-orange);
    color: white;
  }

  @media (max-width: 768px) {
    .sidebar {
      width: 100%;
      position: static;
      max-height: none;
    }
  }
</style>

<script>
  function updateActiveLink() {
    const links = document.querySelectorAll('[data-section]');
    const subsectionLinks = document.querySelectorAll('[data-section]');
    const currentPath = window.location.pathname;

    // Determine current section from path
    let currentSection = 'images';
    if (currentPath !== '/') {
      const pathParts = currentPath.split('/').filter(Boolean);
      if (pathParts.length >= 2 && pathParts[0] === 'dashboard') {
        currentSection = pathParts[1];
      }
    }

    // Update active states for main links
    links.forEach((link) => {
      const section = link.getAttribute('data-section');
      const isParent = link.parentElement.classList.contains('nav-item-with-subsections');
      const isActive = section === currentSection;

      if (isParent) {
        // Don't highlight parent when subsection is active
        if (!subsectionLinks.some(sub => sub.getAttribute('data-section') === currentSection)) {
          link.classList.toggle('active', isActive);
        }
      } else {
        link.classList.toggle('active', isActive);
      }
    });

    // Update active states for subsections
    subsectionLinks.forEach((link) => {
      const subsection = link.getAttribute('data-section');
      link.classList.toggle('active', subsection === currentSection);
    });
  }

  // Listen for section-change events from other pages
  document.addEventListener('section-change', (e: CustomEvent) => {
    const section = e.detail.section;
    if (section) {
      currentSection = section;
      updateActiveLink();
    }
  });

  // Initial load
  document.addEventListener('DOMContentLoaded', updateActiveLink);
  
  // Update on view transitions
  document.addEventListener('astro:page-load', updateActiveLink);
</script>
