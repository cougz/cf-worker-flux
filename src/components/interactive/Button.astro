---
interface Props {
  label: string;
  variant?: 'primary' | 'secondary' | 'danger';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
  loading?: boolean;
  actionName?: string;
  onSuccess?: string;
  onError?: string;
}

const {
  label,
  variant = 'primary',
  size = 'md',
  disabled = false,
  loading = false,
  actionName,
} = Astro.props;
---

<button
  class={`button button-${variant} button-${size}`}
  disabled={disabled || loading}
  data-action={actionName}
>
  {loading ? (
    <span class="button-spinner" />
  ) : null}
  <span class="button-text">{label}</span>
</button>

<style>
  .button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-family: inherit;
    font-weight: 500;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
    position: relative;
    overflow: hidden;
  }

  .button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .button-primary {
    background: var(--cf-orange);
    color: white;
    border: 2px solid var(--cf-orange);
  }

  .button-primary:hover:not(:disabled) {
    background: var(--cf-orange-dark);
    border-color: var(--cf-orange-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .button-secondary {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border: 2px solid var(--border-color);
  }

  .button-secondary:hover:not(:disabled) {
    background: var(--bg-tertiary);
    border-color: var(--cf-orange);
    color: var(--cf-orange);
    transform: translateY(-2px);
  }

  .button-danger {
    background: #dc3545;
    color: white;
    border: 2px solid #dc3545;
  }

  .button-danger:hover:not(:disabled) {
    background: #c82333;
    border-color: #c82333;
    transform: translateY(-2px);
  }

  .button-sm {
    padding: 8px 16px;
    font-size: 0.875rem;
  }

  .button-md {
    padding: 12px 24px;
    font-size: 1rem;
  }

  .button-lg {
    padding: 16px 32px;
    font-size: 1.125rem;
  }

  .button-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid currentColor;
    border-right-color: transparent;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>

<script define:vars={{ actionName }}>
  const button = document.querySelector('button');

  if (actionName && button) {
    button.addEventListener('click', async () => {
      button.disabled = true;
      button.classList.add('loading');

      try {
        const response = await fetch(`/api/actions/${actionName}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({}),
        });

        const result = await response.json();

        button.dispatchEvent(new CustomEvent('button-success', { detail: result }));

        if (result.success) {
          button.classList.add('success');
          setTimeout(() => button.classList.remove('success'), 2000);
        }
      } catch (error) {
        button.dispatchEvent(new CustomEvent('button-error', { detail: error }));
        button.classList.add('error');
        setTimeout(() => button.classList.remove('error'), 2000);
      } finally {
        button.disabled = false;
        button.classList.remove('loading');
      }
    });
  }
</script>
